# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

---

Добрый день!  
Домашнее задание будет выполнено в виде ответов по пунктам.  
Ответы на вопросы выделены *курсивом*

---

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

    *Windows*

    `> ifconfig /all`

    ```
    Ethernet adapter Ethernet:
    
       Description . . . . . . . . . . . : Realtek PCIe GbE Family Controller
       Physical Address. . . . . . . . . : BC-EE-7B-E2-51-91
       DHCP Enabled. . . . . . . . . . . : Yes
       Autoconfiguration Enabled . . . . : Yes
       Link-local IPv6 Address . . . . . : fe80::6425:a03f:1e9c:73d6%14(Preferred)
       IPv4 Address. . . . . . . . . . . : 192.168.10.2(Preferred)
       Subnet Mask . . . . . . . . . . . : 255.255.255.0
       Lease Obtained. . . . . . . . . . : 28 ноября 2021 г. 6:06:53
       Lease Expires . . . . . . . . . . : 13 декабря 2021 г. 3:04:55
       Default Gateway . . . . . . . . . : 192.168.10.1
       DHCP Server . . . . . . . . . . . : 192.168.10.1
       DHCPv6 IAID . . . . . . . . . . . : 113045115
       DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-28-C0-23-47-BC-EE-7B-E2-51-91
       DNS Servers . . . . . . . . . . . : 192.168.10.1
       NetBIOS over Tcpip. . . . . . . . : Enabled
    ```

    *Linux*

    `$ ip -c -br link'

    ```
    lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP> 
    ens33            UP             00:50:56:35:a5:4c <BROADCAST,MULTICAST,UP,LOWER_UP> 
    vmnet1           UNKNOWN        00:50:56:c0:00:01 <BROADCAST,MULTICAST,UP,LOWER_UP> 
    vmnet8           UNKNOWN        00:50:56:c0:00:08 <BROADCAST,MULTICAST,UP,LOWER_UP> 
    ```

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

    *Протокол LLDP*

    *Установка пакета*

    `$ sudo apt install lldpd`

    ```
    $ sudo systemctl enable lldpd
    $ sudo systemctl start lldpd
    ```

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

    *Технология VLAN 802.1q*
    
    *Установка пакета для поддержки vlan*

    `$ sudo apt install vlan`

    *Нужно подгрузить модуль ядра с поддержкой vlan и добавить его в автозагрузку*

    ```
    $ sudo modprobe 8021q
    $ sudo su -c 'echo "8021q" >> /etc/modules'
    ```

    *Создаем интерфейс для vlan 10 имя интерфейса - ens33.10*

    `$ sudo ip link add link ens33 name ens33.10 type vlan id 10`

    *Назначаем интерфейсу адрес 10.0.10.1/24*

    `$ sudo ip addr add 10.0.10.1/24 dev ens33.10`

    *Поднимаем интерфейс*

    `$ sudo ip link set up ens33.10`

    *Для того, чтобы конфигурация была перманентной добавляем в файл /etc/network/interfaces*

    ```
    auto ens33.10
    iface ens33.10 inet static
	address 10.0.10.1
	netmask 255.255.255.0
	vlan-raw-device ens33
    ```

4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

    *Есть агрегация LAG - бондинг. Несколько интерфейсов объеденяются в группу с возможностью балансировки нвгрузки*

    ```
    mode = 0 (round robin) 

    Круговой, циклически использует физические интерфейсы для передачи пакетов. Рекомендован для включения «по умолчанию». Этот режим работает с максимальной отдачей

    mode = 1 (active-backup)

    Работает только один интерфейс, остальные находятся в очереди горячей замены. Если ведущий интерфейс перестает функционировать, то его нагрузку подхватывает следующий (присвоив mac-адрес) и становится активным. Дополнительная настройка коммутатора не требуется.

    mode = 2 (balance-xor)

    XOR политика: Передача на основе [(исходный MAC-адрес → XOR → MAC-адрес получателя) %число интерфейсов]. Эта команда выбирает для каждого получателя определенный интерфейс в соответствии с mac-адресом. Режим обеспечивает балансировку нагрузки и отказоустойчивость.

    mode = 3 (broadcast)

    Все пакеты передаются на все интерфейсы в группе. Режим обеспечивает отказоустойчивость.

    mode = 4 (802.3ad)

    IEEE 802.3ad Dynamic Link aggregation (динамическое объединение каналов). Создает агрегации групп, имеющие одни и те же скорости и дуплексные настройки. Использует все включенные интерфейсы в активном агрегаторе согласно спецификации 802.3ad. Поддержка ethtool (позволяет отображать или изменять настройки сетевой карты) базы драйверов для получения скорости и дуплекса каждого интерфейса. Коммутатор с поддержкой IEEE 802.3ad Dynamic Link aggregation. Большинство параметров потребует некоторой конфигурации для режима 802.3ad.

    mode =5 (balance-tlb)

    Адаптивная балансировка передаваемой нагрузки: канал связи не требует какой либо специальной настройки. Исходящий трафик распределяется в соответствии с текущей нагрузкой (вычисляется по скоростям) для каждого интерфейса. Входящий трафик принимается текущим интерфейсом. Если принимающий интерфейс выходит из строя, то следующий занимает его место приватизировав его mac-адрес. Поддержка ethtool (позволяет отображать или изменять настройки сетевой карты) базы драйверов для получения скорости и дуплекса каждого интерфейса.

    mode = 6 (balance-alb)

    Адаптивное перераспределение нагрузки: включает balance-tlb плюс receive load balancing (rlb) для трафика IPv4 и не требует специального конфигурирования. То есть все так же как и при mode =5, только и входящий трафик балансируется между интерфейсами. Полученная балансировка нагрузки достигается опросом ARP. Драйвер перехватывает ответы ARP, направленные в локальной системе в поисках выхода и перезаписывает исходный адрес сетевой карты с уникальным аппаратным адресом одного из интерфейсов в группе.
    ```

    *Пример конфига в режиме 802.3ad /etc/network/interfaces*

    ```
    auto eth0
    iface eth0 inet manual
        bond-master bond0
    
    auto eth1
    iface eth1 inet manual
        bond-master bond0
    
    auto bond0
    iface bond0 inet static
        address 192.168.1.10
        gateway 192.168.1.1
        netmask 255.255.255.0
        bond-mode 4
        bond-miimon 100
        bond-lacp-rate 1
        bond-slaves eth0 eth1
    ```

5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

    *2^(32-29) = 2^3 = 8*  
    *Но использовать под хосты можно 6. 8-2 = 6 (1 адрес сети, 1 бродкаст).*

    *Внутри /24 сети можно уместить 32 сети /29. Примеры:*  
    *10.10.10.0/29*  
    *10.10.10.8/29*  
    *10.10.10.16.0/29*  
    *10.10.10.24/29 и т.д.*

6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

    *Можно использовать из сети 100.64.0.0/10. Для 40-50 хостов лучше всего подходит сети /26, макстмум на 62 хоста. Сети будут 100.64.0.0/26, 100.64.0.64/26, 100.64.0.128/26 и т.д.*

7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

    *Linux*

    *Посмотреть*  
    `$ ip -br n`

    *Очистить полностью*  
    `$ sudo ip n flush all`

    *Удалить конкретный узел с ip адресом IPADDR*  
    `$ sudo ip n flush IPADDR`

    *Windows*

    *Посмотреть*  
    `> arp -a`

    *Очистить полностью (нужны права админа)*  
    `> arp -d *`

    *Удалить конкретный узел с ip адресом IPADDR (нужны права админа)*  
    `> arp -d IPADDR`


 ---
## Задание для самостоятельной отработки (необязательно к выполнению)

 8*. Установите эмулятор EVE-ng.
 
 Инструкция по установке - https://github.com/svmyasnikov/eve-ng

 Выполните задания на lldp, vlan, bonding в эмуляторе EVE-ng. 
 